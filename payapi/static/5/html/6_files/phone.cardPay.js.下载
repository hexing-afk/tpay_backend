define("phone.cardPay",["up.m.mvc","phone.app","phone.i18"],function(c,a,d){function j(){return this.init.apply(this,arguments)}var o=d.confirmPay,p=d.confirmActivate,q=d.confirmPay,r=d.openAndPay,l={},m={};j.prototype={init:function(a){this.data=a},pageLoad:function(){$("#upopNoticeInfo").show();$(".order-list-wrapper").show();$("#s_language").show();var j=this.data,s=a.constants.requestURL.getCardInfoURL,i=function(g){if("00"!=g.r)a.util.loadingFinish(),a.util.hint.changeHintText(g.m),a.util.hint.showPop();
else{a.util.hideOrderStatus();a.util.hideOrderDetail();a.constants.supportPromotion=!1;if(g.p.displayCardInfo.promotionSupport)for(var i in g.p.displayCardInfo.promotionSupport)a.constants.supportPromotion=a.constants.supportPromotion||g.p.displayCardInfo.promotionSupport[i];a.constants.supportInstalment=!1;g.p.displayCardInfo.supportInstalment&&(a.constants.supportInstalment=g.p.displayCardInfo.supportInstalment);l=g.p.displayCardInfo;m=g.p;a.util.finishLoading();c.$("#overflow-wrapper").css("margin-left",
"100%");setTimeout(function(){var b=g.p;_responseCardInfoParam=b;(b.displayCardInfo.bankNo=="03340000"||b.displayCardInfo.bankNo=="04031000"||b.displayCardInfo.bankNo=="04721460")&&b.displayCardInfo.cardType=="DebitCard"?$.setI18Text("pinCode",$.getI18Text("pinCode_ELE")):$.setI18Text("pinCode",$.getI18Text("pinCode_Normal"));var i;i=b.userInfo&&b.userInfo.hasOwnProperty("username")?c.template.applyTpl(a.TPL.userInfoHTML,b):"";var k="",f=location.hash.slice(1)||"!",f=f.substring(f.indexOf("!")+1,
f.indexOf("?r="));$("#title_tips").text(d.orderPaymentTitle);if(f.indexOf("cardPay")!=-1||f.indexOf("restrictPay")!=-1)k=o;else if(f.indexOf("cardOpen")!=-1)if(f.indexOf("cardOpenAndPay")!=-1)k=r;else if(f.indexOf("cardOpenPay")!=-1)k=q;else{k=p;$("#title_tips").text(d.activate);$(".agreement-wrapper-rememberCard").hide()}else k=o;if((location.hash.slice(1)||"!").indexOf("&parentRoute=")!=-1)b.displayCardInfo.isReopenCard=true;if(b.displayCardInfo.credentialType!="")for(var n=0;n<a.constants.credentialTypeList.length;n++)if(b.displayCardInfo.credentialType==
a.constants.credentialTypeList[n].key){b.displayCardInfo.credentialType=a.constants.credentialTypeList[n].value;break}if(window.cardNumberLocked==true)b.displayCardInfo.useMemorizedCard=true;c.$("#main-container").html(c.template.applyTpl(j,{staticURL:a.constants.staticURL,userInfoHTML:i,cardOpenTipsHTML:"",paybuttonHTML:k,credentialTypeHTML:c.template.applyTpl(a.TPL.credentialTypeHTML_New,{credentialTypeList:a.constants.credentialTypeList,firstCertType:a.constants.credentialTypeList[0],i18:d}),displayCardInfo:b.displayCardInfo,
cardNumberLocked:window.cardNumberLocked,i18:d})).show();c.$("#new_paycard").html(c.template.applyTpl(a.TPL.payCardHTML,{staticURL:a.constants.staticURL,displayCardInfo:b.displayCardInfo,cardNumberLocked:window.cardNumberLocked,bankName:a.util.handleBankName(b.displayCardInfo.bankName),i18:d})).show();a.util.dealRestrictPay(f.indexOf("restrictPay")!=-1);a.util.dealWhiteMerchantCtrl(b.displayCardInfo);c.$("#slider-wrapper").height(function(a){var e=180,d;for(d in a)a[d]==true&&(e=e+45);a.credential==
true&&(e=e+45);e=e+$("#yellow-msg").height();b.displayCardInfo.useMemorizedCard==false&&(e=e+30);if((location.hash.slice(1)||"!").indexOf("&isReopenCard=true")!=-1)e=e+90;return e+"px"}(b.displayCardInfo.rules));c.$("#overflow-wrapper").css("margin-left","0%");window.visiablepan=b.displayCardInfo.cardNumber;if(window.DisCount.isSupport()){window.DisCount.show({promotions:b.promotions,firstPromotion:b.firstPromotion,supportPromotion:a.constants.supportPromotion,data:b});b.displayCardInfo.rules.mobile&&
$("#phoneNumber").blur(function(){var h=$(this).val();if(/^1\d{10}$/.test(h)&&$("#phoneNumber").attr("originalPhoneNumber")!=h){window.DisCount.show({bindId:"",payType:"newCard",mobile:h,supportPromotion:a.constants.supportPromotion,data:b});$("#phoneNumber").attr("originalPhoneNumber",h)}})}$(".select-wrapper-cardList").click(function(){if(window.cardNumberLocked)return null;complete();$("#popInfo").empty().append($(c.template.applyTpl(a.TPL.bankListHTML,$.extend(m,{bankName:a.util.handleBankName(m.displayCardInfo.bankName)},
{staticURL:a.constants.staticURL},{i18:d})))).show();$(".k-bank-date").click(function(){$("#popInfo").hide()});$(".list-return").click(function(){$("#popInfo").hide()});$("#change-other-payment").click(function(){$("#popInfo").hide();m.userInfo&&m.userInfo.hasOwnProperty("username")?a.util.pageRoute({route:"cardChange"}):a.util.pageRoute({route:"cardIndex"})});$("#contentPop").css({top:"0px"});$(".echo_bank").show()});$("#update-mobile").length>0&&$("#update-mobile").click(function(){complete();a.util.reOpenCard({parentRoute:a.util.getCurrentRoute()})});
$(".cancel").length>0&&$(".cancel").click(function(){var h=a.util.getReopenParam(),e="";h.bindId&&(e="&bindId="+h.bindId);if("smsSend"==a.util.base64.decode(h.parentRoute))h.parentRoute=a.util.base64.encode("fastPay");a.util.pageRoute({route:a.util.base64.decode(h.parentRoute)},e)});$(".up-input").focus(function(){complete()});$("#logout").click(a.util.loginOut);$(".op.del").click(function(){$(this).parent().find("input").val("");$(this).addClass("hide")});a.util.cvn2TipsBindEvent();$("#userAgreement").click(function(a){a.preventDefault();
a.stopPropagation();a.cancelBubble=true;require(["phone.pop"],function(a){a.popUserAgreement(true)})});$(".agreement-wrapper4CQP").click(function(){$(".agreement-wrapper4CQP").find("span").toggleClass("hide");$(".agreement-wrapper4CQP").toggleClass("agreed")});$("#cqpAgreement").click(function(a){a.preventDefault();a.stopPropagation();a.cancelBubble=true;require(["phone.pop"],function(a){a.popCQPAgreement()})});$("#userAgreement_BOC").click(function(a){a.preventDefault();a.stopPropagation();a.cancelBubble=
true;require(["phone.pop"],function(a){a.popBOC_Agreement()})});a.util.checkEnable($(".form-container .inner-label-input"),$(".btn-wrapper .next"));$(".agreement-wrapper").click(a.util.toggleAgreement);$(".agreement-wrapper-rememberCard").click(a.util.toggleRememberCardAgreement);window.mode=="sdk"?require(["phone.sdk"],function(a){a.api.getData("up_b2",function(a){a=$.parseJSON(a);a.value=="clear"&&$(".agreement-wrapper-rememberCard").trigger("click")})}):c.util.cookie.getcookie("up_b2")==""&&$(".agreement-wrapper-rememberCard").trigger("click");
window.cardNumberLocked?a.util.hint.init(function(){a.util.hint.removePop()},function(){a.util.hint.removePop()},d.update,d.iknow):a.util.hint.init(function(b){a.util.hint.removePop();b.find("a").removeAttr("href");a.util.pageRoute({route:"cardIndex"})},function(){a.util.hint.removePop()},d.changeCard,d.iknow);a.util.bindSms(function(){var b={ret:"0",params:{smsType:l.smsType}},e=$(".item-mobile");if(e.length>0&&!e.hasClass("hide")&&l.payType=="newCard")if(e=e.find("input").val()){if(!a.util.regex.pass("mobile",
e)){b.ret="1";return b}b.params.mobile=e}else b.ret="1";return b});a.util.credentialTypeBindEvent();$(".btn-wrapper .next").click(function(){function b(c){a.util.loadingFinish();window.mode=="sdk"&&require(["phone.sdk"],function(a){a.api.setPageBackEnable(true)});var d=location.hash.slice(1)||"!";d.indexOf("cardOpen")!=-1&&d.indexOf("cardOpenAndPay")==-1&&d.indexOf("cardOpenPay")==-1?c&&c.p&&c.p.status=="Failed"?e(c.m):a.util.pageRoute({route:"cardOpenPay"}):a.util.pageRoute({route:"result"})}function e(b){a.util.loadingFinish();
window.mode=="sdk"&&require(["phone.sdk"],function(a){a.api.setPageBackEnable(true)});b?a.util.hint.changeHintText(b):a.util.hint.changeHintText(d.retryOrChange+"\uff1f");a.util.hint.showPop()}complete();var c=a.util.validateAndCollect(l);if(c.result!="1")if($(".agreement-wrapper").length>0&&!$(".agreement-wrapper").hasClass("agreed"))a.util.toast(d.agreeConfirm);else{a.util.loadingStart();var g={fireExceedMaxCntEvent:function(){a.util.loadingFinish();a.util.hint.changeHintText(d.anotherCard+"\uff1f");
a.util.hint.showPop()},interval:2E3,payType:l.payType},f={};f.data=c.data;f.url=a.constants.requestURL.cardPayURL;if($(".agreement-wrapper-rememberCard").length>0)f.data.saveMemorizedCard=$(".agreement-wrapper-rememberCard").hasClass("agreed")?true:false;if(c=window.DisCount.getPostData())f.data.discountInfo=c;if(c=window.Instalment.getPostData())f.data.instalmentPeriods=c;window.mode=="sdk"&&require(["phone.sdk"],function(a){a.api.setPageBackEnable(false)});a.flow.trans(f,b,e,g)}});window.Instalment.show({supportInstalment:b.displayCardInfo.supportInstalment});
c.$("#slider-wrapper").height(c.$("#main-container").height()+"px")},500)}};window.initObj&&window.initObj.p&&window.initObj.p.postInfo?(i({r:window.initObj.r,m:window.initObj.m,p:window.initObj.p.postInfo}),window.initObj=null):c.ajax.post(a.util.buildAjaxRequest({url:s,data:a.util.getReopenParam(),success:function(a){a=JSON.parse(a);i(a)},error:function(){console&&console.log("card validate\u5931\u8d25 \uff01")}}));return this}};j.load=function(a){return(new j(a)).pageLoad()};return j});
