window.templates={};
define("up.m.mvc",["zepto","phone.i18"],function(e,p){function i(){return this._init.apply(this,arguments)}var f={},h=function(){return this.init.apply(this,arguments)},l=!1,q=0;h.run=function(a){if(a&&"load"==a.type){if(l)return;l=!0}console.log("loading "+ ++q+"times");var a=location.hash.slice(1)||"!",a=f.util.url(a).url,b=e(".do-return").attr("data-locked"),c=e(".do-return").attr("data-ref");"true"==b?"!cardPay"==a||"!foreignPay"==a||"!cardOpenAndPay"==a||"!prepaidCard"==a||"!crbePay"==a||"!cardOpen"==
a?c?e(".do-return").removeClass("hide"):e(".do-return").addClass("hide"):e(".do-return").addClass("hide"):"!cardIndex"==a||"!"==a?c?e(".do-return").removeClass("hide"):e(".do-return").addClass("hide"):"!result"==a?e(".do-return").addClass("hide"):e(".do-return").removeClass("hide");var d=h.routers[a];if(d)if(d.data)console.log("read from cache !!!!"),d.controller(d.data);else if(d.templateURL)if(-1!=d.templateURL.indexOf(".js")){var m=document.createElement("script");m.async="async";m.src=d.templateURL;
m.onload=function(){d.controller(window.templates.HTML);d.data=window.templates.HTML;e(m).remove()};document.getElementsByTagName("head")[0].appendChild(m)}else f.ajax.get({url:d.templateURL+"?r="+Math.random(),data:{},asyn:!0,dataType:"text/html",success:function(a){d.controller(a);d.data=a},error:function(){d.error&&d.error();console.log("ajax \u83b7\u53d6\u5931\u8d25\uff01")}});else d.controller();else console&&console.log("\u8def\u5f84\u9519\u8bef")};h.routers={};h.prototype={init:function(){window.addEventListener("hashchange",
h.run);window.addEventListener("load",h.run);return this},when:function(a,b,c,d){h.routers[a]={templateURL:b,controller:c,error:d,path:a};return this},run:h.run};f.router=new h;var g=function(){return this};g.prototype={get:function(a){return document.getElementById(a)}};f.jq=new g;f.$=e;f.JSON=JSON;i.settings={};i.settings.timeout=35E3;i.settings.timeoutError=function(){console&&console.log("ajax request time out")};i.prototype={_init:function(){this.xhr=window.XMLHttpRequest?new XMLHttpRequest:
new ActiveXObject("Microsoft.XMLHTTP");return this},get:function(a){var b=this;this.options=this.formatOptions(a);this.isTimeout=!1;b.timeFlag=0;this.xhr.open("GET",a.url+"?"+this.formatParams(a.data),!0);this.xhr.send(null);this.xhr.onreadystatechange=function(){b.onreadystatechange()};b.timeFlag=setTimeout(function(){4!=b.xhr.readyState&&(b.isTimeout=!0,b.xhr.abort(),b.xhr=null,b.options.timeoutError(),clearTimeout(b.timeFlag))},this.options.timeout);return this},post:function(a){var b=this;this.options=
this.formatOptions(a);this.isTimeout=!1;b.timeFlag=0;this.xhr.open("POST",a.url+"?r="+Math.random(),a.async);this.xhr.setRequestHeader("CONTENT-TYPE","application/json; charset=UTF-8;");var c={p:a.data,t:a.data.t+"",s:window.appType,d:f.util.cookie.getcookie("dfpSessionId",!0)};window.l&&(c.l=window.l);var d={};!a.data.cvn2&&!a.data.expire&&(d=null);a.data.cvn2&&(d.cvn2=a.data.cvn2,delete a.data.cvn2);a.data.expire&&(d.expire=a.data.expire,delete a.data.expire);a.data.enCvn2&&(d.enCvn2=a.data.enCvn2,
delete a.data.enCvn2);d&&(a.data.encryptKey=!!window.atmRSA&&window.atmRSA.do_encrypt(JSON.stringify(d)));delete a.data.t;this.xhr.send(JSON.stringify(c));this.xhr.onreadystatechange=function(){b.onreadystatechange()};b.timeFlag=setTimeout(function(){if(b.xhr.readyState!=4){b.isTimeout=true;b.xhr.abort();b.xhr=null;b.options.timeoutError();clearTimeout(b.timeFlag)}},this.options.timeout);return this},formatParams:function(a){var b=[],c;for(c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));
b.push(("v="+Math.random()).replace(".",""));return b.join("&")},formatOptions:function(a){a=a||{};a.type=(a.type||"GET").toUpperCase();a.dataType=a.dataType||"json";a.async=!!a.async;a.timeout=!!a.timeout||i.settings.timeout;a.timeoutError=a.timeoutError?a.timeoutError:i.settings.timeoutError;return a},onreadystatechange:function(){if(4==this.xhr.readyState){var a=this.xhr.status;if(200<=a&&300>a&&!this.isTimeout){clearTimeout(this.timeFlag);this.timeFlag=0;if(-1!=this.xhr.responseText.indexOf("errorResultPage"))return window.errorResultPage=
this.xhr.responseText,window.location="#!errorResultPage?r="+Math.random(),!1;this.options.success&&this.options.success(this.xhr.responseText,this.xhr.responseXML);this.xhr=null}else clearTimeout(this.timeFlag),this.timeFlag=0,this.xhr=null,this.options.error&&this.options.error(p.ajaxError+"["+a+"]")}}};f.ajax={};f.ajax.get=function(a){(new i).get(a)};f.ajax.post=function(a){(new i).post(a)};g=function(){function a(){window.customPageJson&&(window.customPageJson.bgColor&&e(".label-input-k").css("background",
window.customPageJson.bgColor),window.customPageJson.elColor&&e(".header").css("background",window.customPageJson.elColor),window.customPageJson.elColor&&(e(".up-btn.next").css("background-color",window.customPageJson.elColor),e(".up-btn.next").css("background-image","none"),e(".up-btn.next").css("border",window.customPageJson.elColor)),window.customPageJson.logoUrl&&(e("#title_tips").text(""),"1"==window.customPageJson.template&&e(".bottom_logo img").attr("src",window.customPageJson.logoUrl)),"1"==
window.customPageJson.template&&window.customPageJson.elColor&&e(".up-btn.sms").css("border","1px solid "+window.customPageJson.elColor),e(".up-btn.sms").css("color",window.customPageJson.elColor+" !important"))}function b(a,b){var c=a.split("."),e=0;do if(b=b[c[e++]],null==b)break;while(e<c.length&&"object"==typeof b);return b}function c(a,e,f,h,i){var g=/<(tpl\d?)\s+(\w+)\s*=\s*(['|"]{1})([^\3]+?)\3\s*>([\s\S]+?)<\/\1>/ig;g.test(a)&&(a=a.replace(g,function(a,d,j,n,k,g){a="";if(null!=j)if("FOR"==
j.toUpperCase()){j=e;"."!=k&&(j=b(k,e));for(d=0;null!=j&&d<j.length;d++)n={},"object"!=typeof j[d]?n.__val=j[d]:n=j[d],n.__offset=d,a+=c(g,n,f,k,j)}else if("IF"==j.toUpperCase())try{if(eval(applyTpl(k,e)))return c(g,e,f,h,i)}catch(l){console&&console.log(k||l.message||l)}return a}));return a.replace(/\$?\{([^\}]+?)\}/ig,function(a,c){try{var d=b(c,e),d=null==d?a:d;if("function"==typeof f){var g=f.call(this,c,d,e,h,i);return null==g?d:g}return d}catch(k){return alert(c||k.message||k),null}})}return function(){this.customPage=
a;this.diving=b;this.applyTpl=c;return this}}()();f.template=g;var o=function(a){this.url=a||"";this.query={};this.parse()};o.prototype={parse:function(a){a&&(this.url=a);this.parseAnchor();this.parseParam()},parseAnchor:function(){var a=this.url.match(/\#(.*)/);this._anchor=a=a?a[1]:null;null!=a&&(this.anchor=this.getNameValuePair(a),this.url=this.url.replace(/\#.*/,""))},parseParam:function(){var a=this.url.match(/\?([^\?]*)/),a=a?a[1]:null;null!=a&&(this.url=this.url.replace(/\?([^\?]*)/,""),this.query=
this.getNameValuePair(a))},getNameValuePair:function(a){var b={};a.replace(/([^&=]*)(?:\=([^&]*))?/gim,function(a,d,e){""!=d&&(b[d]=e||"")});return b},getParam:function(a){return this.query[a]||""},clearParam:function(){this.query={}},setParam:function(a,b){if(null==a||""==a||"string"!=typeof a)throw Error("no param name set");this.query=this.query||{};this.query[a]=b},setParams:function(a){this.query=a},serialize:function(a){var b=[],c;for(c in a)null==a[c]||""==a[c]?b.push(c+"="):b.push(c+"="+a[c]);
return b.join("&")},toString:function(){var a=this.serialize(this.query);return this.url+(0<a.length?"?"+a:"")+(this.anchor?"#"+this.serialize(this.anchor):"")},getHashStr:function(a){return this.anchor?"#"+this.serialize(this.anchor):a?"#":""}};f.util={url:function(a){return new o(a)},getScript:function(a,b){var c=document.createElement("script");c.async="async";c.src=a;b&&(c.onload=b);document.getElementsByTagName("head")[0].appendChild(c)},cookie:{setcookie:function(a,b,c,d,e){if(c){var f=new Date;
f.setTime(f.getTime()+1E3*c);document.cookie=escape(a)+"="+escape(b)+(f?"; expires="+f.toGMTString():"")+(d?"; path="+d:"/")+(e?"; domain="+e:"")+(-1!=window.location.href.split("/")[0].indexOf("https")?"; secure":"")}else document.cookie=escape(a)+"="+escape(b)+(d?"; path="+d:"/")+(e?"; domain="+e:"")+(-1!=window.location.href.split("/")[0].indexOf("https")?"; secure":"")},getcookie:function(a,b){var c=document.cookie.indexOf(a),d=document.cookie.indexOf(";",c);if(-1==c)return null;c=document.cookie.substring(c+
a.length+1,d>c?d:document.cookie.length);return!b?unescape(c):c}}};Date.prototype.Format=function(a){var b={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var c in b)RegExp("("+c+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?b[c]:("00"+b[c]).substr((""+b[c]).length)));
return a};e(document).ready(function(a){if(window.history&&window.history.pushState)a(window).on("popstate",function(){window.history.forward(1)})});return f});
