define("phone.index",["up.m.mvc","phone.app","phone.i18"],function(g,a,d){function f(){this.TPL=i;f.instance||(f.instance=this._init.apply(this,arguments));return f.instance}var i={tipsBlock:'<p class="toast hide"></p>                <div class="popup-block  hide" style="z-index:30000">                    <div class="confirm-block">                        <p class="hintTitle">${i18.tips}</p>                        <p class="hint">                        ${i18.tipsInfo}                        </p>                        <div class="btn-group">                            <div class="up-btn popup-left fl">                                <a>${i18.downloadNow}</a>                            </div>                            <div class="up-btn popup-right fl">                                <a>${i18.changeCard}</a>                            </div>                        </div>                    </div>                </div>',
orderInfo:'<p class="order-item-pay-amount">${order.amountSymbol}<span id="order-item-pay-amount">${order.orderAmount}</span></p>                    <p class="order-item-origin-amount">${order.amountSymbol}<span id="order-item-origin-amount">${order.orderAmount}</span></p>                    <p class="order-item"><label>${i18.merchantName}</label><span>${order.merchantName}</span></p>                    <p class="order-item fold hide"><label>${i18.orderTime}</label><span>${order.orderTime}</span></p>                    <p class="order-item fold hide"><label>${i18.orderNumber}</label><span>${order.orderNumber}</span></p>                    <div class="btn-show-order-dash grey fold hide"></div>'};
f.instance=null;f.prototype={_init:function(){return this},_getOrderInfo:function(h){var k=a.constants.requestURL.getOrderInfoURL;location.hash.slice(1);try{window.l=window.location.href.split("/")[4]}catch(f){window.l="zh_CN"}var j=function(b){window.cardNumberLocked=!!b.p.cardNumberLocked;window.clientBind=!!b.p.clientBind;window.inCardList=!!b.p.inCardList;window.promotionUrl=b.p.promotionUrl?b.p.promotionUrl+a.constants.requestURL.getPromotionInfo:a.requestBaseURL+a.constants.requestURL.getPromotionInfo;
window.couponInfoURL=b.p.promotionUrl?b.p.promotionUrl+a.constants.requestURL.getCouponInfoURL:a.requestBaseURL+a.constants.requestURL.getCouponInfoURL;window.topPointInfoURL=b.p.promotionUrl?b.p.promotionUrl+a.constants.requestURL.getTopPointInfoURL:a.requestBaseURL+a.constants.requestURL.getTopPointInfoURL;if(b.p.payCardType||b.p.issIns)window.mer_card_tips=d.supportCard,b.p.issIns&&(window.mer_card_tips+=b.p.issIns),window.mer_card_tips=b.p.payCardType?window.mer_card_tips+b.p.payCardType:window.mer_card_tips+
d.card;if("00"!=b.r)a.util.finishLoading(),$(".order-list-wrapper").hide(),$("#main-container").html('<div class="pay_success" id="pay_success"><div class="pay_img_div"><span class="error_result"></span>'+b.m+"</div></div>");else{var e=location.hash.slice(1)||"!";b.p.crbePay&&-1==e.indexOf("result")&&(window.crbePay=b.p.crbePay,h||a.util.pageRoute({route:"crbePay"}));var c=b.p,e=g.template.applyTpl(i.orderInfo,$.extend(c,{i18:d}));$(".order-list").empty();$(".order-list").append($(e));a.constants.sk=
c.sk;window.publicKey=c.modulus;window.exponent=c.exponent;a.constants.supportPromotion=c.supportPromotion;a.constants.orderInfo=c.order;window.PayDiscount.init(Math.round(100*c.order.orderAmount));c.userInfo&&c.userInfo.hasOwnProperty("username")&&(a.constants.userInfo=c.userInfo);c.order.transType&&"02"==c.order.transType.transType?!0==c.order.transType.preAuth?$("#preAuth").addClass("preAuth").html(d.preAuth):($("#preAuth").addClass("preAuth").addClass("guarantee").html(d.guarantee),$("#preAuth").css("padding-top",
"2px"),$("#preAuth").css("padding-bottom","2px"),$("#preAuth").css("margin-top","1px")):$("#preAuth").removeClass("preAuth").html("");e=[];c.merchantPayDefaultTip&&e.push("<span>\u25cf</span><p>"+c.merchantPayDefaultTip+"</p>");c.order.allowedCardType&&"creditCard"==c.order.allowedCardType?d.cardNumberTips=d.creditCard:c.order.allowedCardType&&"debitCard"==c.order.allowedCardType&&(d.cardNumberTips=d.debitCard);if(c.orderTimeoutTips){var f=new Date(parseInt(c.orderTimeoutTips)),f=d.timeOutTips.replace("{0}",
(new Date(f)).Format("yyyy/MM/dd hh:mm:ss").split(" ")[1]);-1!=navigator.userAgent.toLowerCase().indexOf("android")?$("#title_tips").removeClass("title_android").addClass("title_android_with_paytiemout").show():$("#title_tips").removeClass("title").addClass("title_with_paytiemout").show();$("#paytimeout_tips").css("display","block");$("#paytimeout_tips").text(f)}c.railwayPromptText&&e.push("<span>\u25cf</span><p>"+c.railwayPromptText+"</p>");c.foreignPayTips&&e.push("<span>\u25cf</span><p>"+c.foreignPayTips+
"</p>");0<e.length&&$("#upopNoticeInfo").html(e.join(""));g.util.getScript(a.constants.upadmURL,function(){console&&console.log("loading upadmURL logging!!!!");try{c.merchantCode?UPADM&&UPADM.autoRender&&UPADM.autoRender({merchantId:c.merchantCode}):UPADM&&UPADM.autoRender&&UPADM.autoRender({})}catch(a){console&&console.log(a)}});a.util.finishLoading();b.p.qr&&(window.qrParam={qr:b.p.qr,qrcodeDomain:b.p.qrcodeDomain,qrcode:b.p.qrcode,merchantCode:b.p.merchantCode,orderNumber:b.p.order.orderNumber,
orderTime:b.p.order.orderTime},e=location.hash.slice(1)||"!","!"==e&&-1==e.indexOf("result")&&a.util.pageRoute({route:"erweima"}));e=location.hash.slice(1)||"!";e=e.substring(e.indexOf("!")+1,e.indexOf("?r="));if(b.p.cardNumberLocked||b.p.clientBind){if(b.p.token&&(g.util.cookie.setcookie("m_t_key",b.p.token,null,"/"),window.tokenId=b.p.token),-1==(location.hash.slice(1)||"!").indexOf("result"))h||e!=b.p.route&&a.util.pageRoute(b.p)}else if("!"==e||-1!=e.indexOf("index")){if("!"==e){if(b.p.token){g.util.cookie.setcookie("m_t_key",
b.p.token,null,"/");window.tokenId=b.p.token;h||a.util.pageRoute({route:"fastPay"});return}if(g.util.cookie.getcookie("up_b8")&&"ProPay"==g.util.cookie.getcookie("up_b8")){h||a.util.pageRoute({route:"userLogin"});return}}h||a.util.pageRoute({route:"cardIndex"})}}};window.initObj?j(window.initObj):g.ajax.post(a.util.buildAjaxRequest({url:k,data:{sign:g.util.url(window.location.href).query.sign},success:function(a){a=JSON.parse(a);j(a)},error:function(){console&&console.log("\u8ba2\u5355\u4fe1\u606f ajax \u83b7\u53d6\u5931\u8d25\uff01")}}))},
_bindEvent:function(){a.util.initToast();a.util.hint.init(function(d){a.util.hint.removePop();d.find("a").removeAttr("href");a.util.pageRoute({route:"cardIndex"})},function(){a.util.hint.removePop()},d.changeCard,d.iknow);$(".op.del").click(function(){$(this).parent().find("input").val("");$(this).addClass("hide")});$("#order-list-block-show").unbind("click");$("#order-list-block-show").click(a.util.handleOrderFolder);window.localeStr&&($("#echo_language_ul li").removeClass("language_action"),$("#lang-"+
window.localeStr).addClass("language_action"));$("#s_language").show();$("#s_language").click(function(){if((location.hash.slice(1)||"!").indexOf("result")==-1)$("#echo_language").css("display")=="block"?$("#echo_language").hide():$("#echo_language").show()});a.util.bindReturn();String.prototype.replaceAll=function(a,d){return this.replace(RegExp(a,"gm"),d)};$("#echo_language_ul li").each(function(){$(this).click(function(){var d=$(this);$("#echo_language_ul li").each(function(){$(this).removeClass("language_action")});
d.addClass("language_action");setTimeout(function(){$("#echo_language").hide();if(window.location.href.indexOf("//"+d.attr("id").split("-")[1]+"//")==-1)for(var f=0;f<a.constants.langStrArray.length;f++)if(window.location.href.indexOf(a.constants.langStrArray[f])!=-1){window.location.href=window.location.href.replaceAll(a.constants.langStrArray[f],d.attr("id").split("-")[1]);window.l=d.attr("id").split("-")[1];break}},400)})});return this},actionLoad:function(){-1!=navigator.userAgent.toLowerCase().indexOf("android")?
$("#title_tips").removeClass("title").addClass("title_android").show():$("#title_tips").show();$("#upopNoticeInfo").show();$(".order-list-wrapper").show();$(document.body).append($(g.template.applyTpl(i.tipsBlock,{i18:d})));a.util.hideOrderStatus();this._bindEvent();this._getOrderInfo(!0);try{"cardIndex"==window.actionRouter&&require(["phone.cardIndex"],function(a){a.actionLoad()})}catch(f){}return this},load:function(){-1!=navigator.userAgent.toLowerCase().indexOf("android")?$("#title_tips").removeClass("title").addClass("title_android").show():
$("#title_tips").show();$("#upopNoticeInfo").show();$(".order-list-wrapper").show();$(document.body).append($(g.template.applyTpl(i.tipsBlock,{i18:d})));a.util.hideOrderStatus();this._bindEvent();this._getOrderInfo();return this}};f.getInstance=function(a){return new f(a)};f.systemError=function(){a.util.hint.init(function(){a.util.hint.removePop()},function(){a.util.hint.removePop();window.location.href=window.location.href},d.iknow,d.changeCard);a.util.loadingFinish();a.util.hint.changeHintText(d.systemException);
a.util.hint.showPop()};return f});
